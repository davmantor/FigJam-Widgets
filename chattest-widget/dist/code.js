(()=>{var j=Object.defineProperty,O=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var L=(e,o,d)=>o in e?j(e,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[o]=d,T=(e,o)=>{for(var d in o||(o={}))q.call(o,d)&&L(e,d,o[d]);if(S)for(var d of S(o))G.call(o,d)&&L(e,d,o[d]);return e},M=(e,o)=>O(e,Y(o));var{widget:k}=figma,{AutoLayout:a,Text:u,useSyncedState:m,Input:J,Frame:K}=k;function Q(){console.log("ChatWidget rendered2");let[e,o]=m("newMessage",""),[d,f]=m("replyToId",null),[s,c]=m("messages",[]),[h,C]=m("userName","Anonymous"),[D,F]=m("inputPlaceholder","Type a message..."),[b,l]=m("inputActive",!1),[p,g]=m("isEditing",!1),v=()=>figma.widget.h(K,{width:"fill-parent",height:500,overflow:"scroll"},figma.widget.h(a,{direction:"vertical",spacing:-100,padding:4},x())),E=()=>{figma.currentUser&&figma.currentUser.name&&C(figma.currentUser.name)},z=()=>{if(console.log("handleAddMessage called1"),E(),e.trim()!==""){let n=Date.now(),t=new Date(n),i=t.getHours(),r=t.getMinutes(),y=r<10?"0"+r:r.toString(),A=i>=12?"PM":"AM",N=`${i%12||12}:${y} ${A}`,H=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:h;if(p){let I=s.map(R=>R.id===d?M(T({},R),{text:e.trim(),edited:!0}):R);c(I),f(null),g(!1)}else{let I={id:n,parentId:d,text:e.trim(),sender:H,timestamp:N,edited:!1,deleteConfirm:!1};c([...s,I]),f(null),g(!1)}o(""),F("Type a message..."),l(!0),setTimeout(()=>l(!1),2e3)}},U=n=>{f(n);let t=s.find(i=>i.id===n);t&&(o(""),F(`Reply to "${t.text}":`)),l(!0),setTimeout(()=>l(!1),2e3),g(!1)},B=n=>{if(s.find(i=>i.id===n)){let i=s.map(r=>r.id===n?M(T({},r),{text:"this message has been deleted",sender:"Anonymous",edited:!1}):r);c(i),f(null),o(""),F("Type a message..."),l(!0),setTimeout(()=>l(!1),2e3)}},P=n=>{let t=s.find(i=>i.id===n);t&&t.deleteConfirm===!1?c(i=>i.map(r=>r.id===n?M(T({},r),{deleteConfirm:!0}):r)):c(i=>i.map(r=>r.id===n?M(T({},r),{deleteConfirm:!1}):r))},W=n=>{let t=s.find(i=>i.id===n);t&&(f(n),o(t.text),F(`Edit message: "${t.text}"`),l(!0),g(!0),setTimeout(()=>l(!1),2e3))},$=n=>{if(!s.find(y=>y.id===n))return 0;let i=0,r=(y,A)=>{s.forEach(w=>{w.parentId===y&&r(w.id,A+1)}),A>i&&(i=A)};return r(n,0),i},x=(n=null)=>(console.log("render"),s.filter(t=>t.parentId===n).map(t=>figma.widget.h(V,{key:t.id,message:t,onReply:()=>U(t.id),onEdit:()=>W(t.id),onDelete:()=>B(t.id),onDeleteConfirm:()=>P(t.id),replyChain:x(t.id),replyToId:d,user:h,getMessageDepth:$})));return figma.widget.h(a,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:10},figma.widget.h(a,{direction:"horizontal",spacing:100,padding:8,stroke:b?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(J,{placeholder:D,value:e,onTextEditEnd:n=>o(n.characters)}),figma.widget.h(a,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:z},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(a,{direction:"vertical",spacing:1,padding:4},x()))}function V({message:e,onReply:o,onDelete:d,onEdit:f,replyChain:s,replyToId:c,user:h,onDeleteConfirm:C,getMessageDepth:D}){console.log("MessageBubble called with message:",e,"and replyToId:",c);let F=e.parentId!==null,b=c===e.id;console.log(`Message ID: ${e.id}, ReplyTo ID: ${c}, Is Being Replied To: ${b}`);let l={fill:b?"#007AFF":"#FFFFFF",color:b?"#FFFFFF":"#000000"};console.log(l);let p=e.sender===h,g=e.edited,v=D(e.id);return console.log("edited",g),console.log("user",h),console.log("sender",e.sender),console.log(p),figma.widget.h(a,{direction:"vertical"},figma.widget.h(a,{direction:"vertical",padding:{top:10,bottom:10,left:8,right:8},stroke:"#D3D3D3",strokeWidth:1,cornerRadius:4,fill:l.fill,width:"fill-parent",maxWidth:350,maxHeight:100},figma.widget.h(a,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:155,padding:{top:4,bottom:1,left:4,right:4}},figma.widget.h(u,{fontSize:14,fill:l.color},e.sender,":"),figma.widget.h(u,{fontSize:12,fill:l.color},e.timestamp)),figma.widget.h(a,{direction:"horizontal",padding:{top:4,bottom:4,left:4,right:4},fill:l.fill},figma.widget.h(u,null," ",e.text),g&&figma.widget.h(u,{fontSize:12,fill:"#808080"}," (edited)")),figma.widget.h(a,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},spacing:8},figma.widget.h(a,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:o},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Reply")),p&&!e.deleteConfirm&&figma.widget.h(a,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:C},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Delete")),p&&e.deleteConfirm&&figma.widget.h(a,{fill:"#FFFFFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:C,stroke:"#808080"},figma.widget.h(u,{fontSize:14,fill:"#808080"},"Cancel")),p&&e.deleteConfirm&&figma.widget.h(a,{fill:"#FFFFFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:d,stroke:"#FF3B30"},figma.widget.h(u,{fontSize:14,fill:"#FF3B30"},"Confirm Deletion")),p&&figma.widget.h(a,{fill:"#808080",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:f},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Edit")))),figma.widget.h(a,{direction:"vertical",padding:{top:10,bottom:10,left:32,right:8}},s&&figma.widget.h(a,{direction:"vertical",spacing:10,width:"fill-parent"},s)))}k.register(Q);})();
