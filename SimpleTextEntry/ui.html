<!-- ui.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      :root {
        color-scheme: light dark;
        --bg: #F1F5F9;
        --fg: #303844;
        --muted: #747470;
        --card: #FFFFFF;
        --border: #ACACAC;
        --accent: #6ea6fb;
        --accent-fg: #FFFFFF;
        --danger: #DC2626;     /* red for error text */
        --danger-fg: #FFFFFF;
        --highlight: #F2DE56;  /* yellow for reset button */
        --ring: 0 0 0 3px color-mix(in oklab, var(--accent) 20%, transparent);
        --radius: 10px;
        --radius-sm: 8px;
      }

      html, body { height: 100%; }
      body {
        margin: 12px;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        font-size: 13px;
        background: var(--bg);
        color: var(--fg);
      }

      .hidden { display: none; }

      .surface {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 12px;
      }

      .titlebar {
        display: flex; align-items: center; justify-content: space-between;
        margin-bottom: 10px;
      }
      .title { font-weight: 700; font-size: 13px; letter-spacing: .2px; }
      .subtitle { color: var(--muted); font-size: 12px; }

      .section {
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        padding: 10px;
        margin-top: 10px;
      }
      .section h4 {
        margin: 0 0 8px 0;
        font-size: 12px;
        letter-spacing: .2px;
      }

      .row { margin-top: 8px; }
      label {
        display: block;
        margin-bottom: 4px;
        font-weight: 600;
        font-size: 12px;
      }

      input[type="number"],
      input[type="text"],
      input[type="password"] {
        width: 100%;
        box-sizing: border-box;
        padding: 6px 8px;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--fg);
        border-radius: 6px;
        outline: none;
      }
      input::placeholder { color: var(--muted); }
      input:focus { border-color: var(--accent); box-shadow: var(--ring); }

      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      @media (max-width: 520px) { .grid { grid-template-columns: 1fr; } }

      .btns {
        display: flex; gap: 8px; margin-top: 12px; justify-content: flex-end;
      }
      button {
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 8px;
        cursor: pointer;
        transition: transform .02s ease, opacity .15s ease, background .15s;
        background: #0f172a; color: #ffffff;
      }
      button:hover { opacity: .92; }
      button:active { transform: translateY(1px); }
      .btn-ghost { background: transparent; color: var(--fg); }
      .btn-accent {
        background: var(--accent);
        color: var(--accent-fg);
        border-color: color-mix(in oklab, var(--accent) 70%, var(--border));
      }
      .btn-danger {
        background: var(--danger);
        color: var(--danger-fg);
        border-color: color-mix(in oklab, var(--danger) 70%, var(--border));
      }
      .btn-highlight {
        background: var(--highlight);
        color: #303844; /* dark text for contrast on yellow */
        border-color: color-mix(in oklab, var(--highlight) 70%, var(--border));
      }

      .error {
        color: var(--danger); /* stays red */
        font-size: 12px;
        margin-top: 6px;
        min-height: 14px;
      }
    </style>
  </head>
  <body>
    <div class="surface">
      <!-- Password view -->
      <div id="pw" class="">
        <div class="titlebar">
          <div>
            <div class="title">Admin access</div>
            <div class="subtitle">Enter password to unlock controls</div>
          </div>
        </div>

        <div class="row">
          <label>Password</label>
          <input id="pwd" type="password" autocomplete="current-password" enterkeyhint="go" />
          <div id="err" class="error" aria-live="polite"></div>
        </div>

        <div class="btns">
          <button id="unlock" class="btn-accent">Unlock</button>
        </div>
      </div>

      <!-- Admin panel view -->
      <div id="panel" class="hidden">
        <div class="titlebar">
          <div class="title">Widget settings</div>
        </div>

        <div class="section">
          <h4>Frame</h4>
          <div class="grid">
            <div class="row">
              <label>Width (px)</label>
              <input id="width" type="number" min="280" max="1200" step="10" />
            </div>
            <div class="row">
              <label>Height (px)</label>
              <input id="height" type="number" min="160" max="1200" step="10" />
            </div>
            <div class="row">
              <label>Font size (base)</label>
              <input id="fontSize" type="number" min="10" max="24" step="1" />
            </div>
            <div class="row">
              <label>Border width (px)</label>
              <input id="borderWidth" type="number" min="0" max="8" step="1" />
            </div>
            <div class="row">
              <label>Border color</label>
              <input id="borderColor" type="text" placeholder="#000000" />
            </div>
          </div>
        </div>

        <div class="section">
          <h4>Shadow</h4>
          <div class="grid">
            <div class="row">
              <label>Color</label>
              <input id="shadowColor" type="text" placeholder="#000000" />
            </div>
            <div class="row">
              <label>Blur</label>
              <input id="shadowBlur" type="number" min="0" max="64" step="1" />
            </div>
            <div class="row">
              <label>Spread</label>
              <input id="shadowSpread" type="number" min="0" max="32" step="1" />
            </div>
            <div class="row">
              <label>Offset X</label>
              <input id="shadowOffsetX" type="number" min="-32" max="32" step="1" />
            </div>
            <div class="row">
              <label>Offset Y</label>
              <input id="shadowOffsetY" type="number" min="-32" max="32" step="1" />
            </div>
          </div>
        </div>

        <div class="btns">
          <button id="unlockEdit" class="btn-accent">Edit submission</button>
          <button id="reset" class="btn-highlight">Reset submission</button>
        </div>
      </div>
    </div>

    <script>
      parent.postMessage({ pluginMessage: { type: "ready" } }, "*");

      const pw = document.getElementById("pw");
      const panel = document.getElementById("panel");
      const err = document.getElementById("err");

      const widthEl = document.getElementById("width");
      const heightEl = document.getElementById("height");
      const fontSizeEl = document.getElementById("fontSize");
      const borderWidthEl = document.getElementById("borderWidth");
      const borderColorEl = document.getElementById("borderColor");

      const shadowColorEl = document.getElementById("shadowColor");
      const shadowOffsetXEl = document.getElementById("shadowOffsetX");
      const shadowOffsetYEl = document.getElementById("shadowOffsetY");
      const shadowBlurEl = document.getElementById("shadowBlur");
      const shadowSpreadEl = document.getElementById("shadowSpread");

      const pwdEl = document.getElementById("pwd");
      const unlockBtn = document.getElementById("unlock");

      pwdEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === "NumpadEnter") {
          e.preventDefault();
          unlockBtn.click();
        }
      });

      function showPassword() {
        pw.classList.remove("hidden");
        panel.classList.add("hidden");
        err.textContent = "";
        document.getElementById("pwd").focus();
      }
      function showPanel(values) {
        pw.classList.add("hidden");
        panel.classList.remove("hidden");
        if (values) {
          widthEl.value = values.boxWidth ?? 1020;
          heightEl.value = values.boxHeight ?? 235;
          fontSizeEl.value = values.fontSizeBase ?? 16;
          borderWidthEl.value = values.borderWidth ?? 1;
          borderColorEl.value = values.borderColor ?? "#000000";

          shadowColorEl.value = values.shadowColor ?? "#000000";
          shadowOffsetXEl.value = values.shadowOffsetX ?? 0;
          shadowOffsetYEl.value = values.shadowOffsetY ?? 2;
          shadowBlurEl.value = values.shadowBlur ?? 10;
          shadowSpreadEl.value = values.shadowSpread ?? 0;
        }
      }

      onmessage = (event) => {
        const msg = event.data?.pluginMessage;
        if (!msg) return;
        if (msg.type === "promptPassword") showPassword();
        if (msg.type === "error") err.textContent = msg.message || "";
        if (msg.type === "showAdminPanel") showPanel(msg.values || {});
      };

      document.getElementById("unlock").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "passwordSubmit", value: document.getElementById("pwd").value } }, "*");
      document.getElementById("reset").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "resetResponse" } }, "*");

      // Live updates
      widthEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateWidth", value: Number(widthEl.value) } }, "*");
      heightEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateHeight", value: Number(heightEl.value) } }, "*");
      fontSizeEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateFontSize", value: Number(fontSizeEl.value) } }, "*");
      borderWidthEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateBorderWidth", value: Number(borderWidthEl.value) } }, "*");
      borderColorEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateBorderColor", value: borderColorEl.value.trim() } }, "*");

      // Shadow live updates
      shadowColorEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowColor", value: shadowColorEl.value.trim() } }, "*");
      shadowOffsetXEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowOffsetX", value: Number(shadowOffsetXEl.value) } }, "*");
      shadowOffsetYEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowOffsetY", value: Number(shadowOffsetYEl.value) } }, "*");
      shadowBlurEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowBlur", value: Number(shadowBlurEl.value) } }, "*");
      shadowSpreadEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowSpread", value: Number(shadowSpreadEl.value) } }, "*");

      document.getElementById("unlockEdit").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "unlockForEdit" } }, "*");
    </script>
  </body>
</html>
