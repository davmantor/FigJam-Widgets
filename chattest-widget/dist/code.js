"use strict";(()=>{var{widget:b}=figma,{AutoLayout:o,Text:c,useSyncedState:d,Input:x,Frame:v}=b;function L(){console.log("ChatWidget rendered2");let[n,u]=d("newMessage",""),[p,g]=d("replyToId",null),[r,f]=d("messages",[]),[a,s]=d("userName","Anonymous"),[A,F]=d("inputPlaceholder","Type a message..."),[M,m]=d("inputActive",!1);console.log("Current messages:",r);let C=()=>figma.widget.h(v,{width:"fill-parent",height:500,overflow:"scroll"},figma.widget.h(o,{direction:"vertical",spacing:-100,padding:4},h())),z=()=>{figma.currentUser&&figma.currentUser.name&&s(figma.currentUser.name)};function T(t){let e=r.find(i=>i.id===t);if(e){let i=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:a,l=e.sender;e.sender==i?(f(r.filter(y=>y.id!==t)),console.log("deleted",t,figma.currentUser,l)):console.log("not deleted - wrong user",t,figma.currentUser,l)}}let w=()=>{if(console.log("handleAddMessage called"),n.trim()!==""){let t=Date.now(),e=new Date(t),i=e.getHours(),l=e.getMinutes(),y=l<10?"0"+l:l.toString(),D=i>=12?"PM":"AM",I=`${i%12||12}:${y} ${D}`,U=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:a,S={id:t,parentId:p,text:n.trim(),sender:U,timestamp:I};f([...r,S]),u(""),g(null),F("Type a message..."),m(!0),setTimeout(()=>m(!1),2e3)}},R=t=>{g(t);let e=r.find(i=>i.id===t);e&&(u(""),F(`Reply to "${e.text}":`)),m(!0),setTimeout(()=>m(!1),2e3)},h=(t=null)=>(console.log("render"),r.filter(e=>e.parentId===t).map(e=>figma.widget.h(k,{key:e.id,message:e,onReply:()=>R(e.id),onDelete:()=>T(e.id),replyChain:h(e.id),replyToId:p})));return figma.widget.h(o,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(o,{direction:"horizontal",spacing:100,padding:8,stroke:M?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(x,{placeholder:A,value:n,onTextEditEnd:t=>u(t.characters)}),figma.widget.h(o,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:w},figma.widget.h(c,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(o,{direction:"vertical",spacing:-100,padding:4},h()))}function k({message:n,onReply:u,onDelete:p,replyChain:g,replyToId:r}){console.log("MessageBubble called with message:",n,"and replyToId:",r);let f=n.parentId!==null,a=r===n.id;console.log(`Message ID: ${n.id}, ReplyTo ID: ${r}, Is Being Replied To: ${a}`);let s={fill:a?"#007AFF":"#FFFFFF",color:a?"#FFFFFF":"#000000"};return console.log(s),figma.widget.h(o,{direction:"vertical",padding:{top:1,bottom:10,left:f?32:8,right:8},stroke:"#D3D3D3",strokeWidth:1,cornerRadius:4,fill:s.fill},figma.widget.h(o,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:150,padding:{top:4,bottom:0,left:4,right:4}},figma.widget.h(c,{fontSize:14,fill:s.color},n.sender,":"),figma.widget.h(c,{fontSize:12,fill:s.color},n.timestamp)),figma.widget.h(o,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},fill:s.fill},figma.widget.h(c,null," ",n.text)),figma.widget.h(o,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},spacing:8},figma.widget.h(o,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:u},figma.widget.h(c,{fontSize:14,fill:"#FFFFFF"},"Reply")),figma.widget.h(o,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:p},figma.widget.h(c,{fontSize:14,fill:"#FFFFFF"},"Delete"))),g&&figma.widget.h(o,{direction:"vertical",spacing:30},g))}b.register(L);})();
