<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Likert Scale Widget</title>
</head>
<style>
  h3 {
    overflow-wrap: break-word;
    display: none;
  }
  body {
    font-family: sans-serif;
  }
  textarea {
    width: 100%;
    border-radius: 5px;
    font-size: 1.5em;
    height: calc(100% - 100px);
    font-family: sans-serif;
    resize: vertical;
  }
  select, button, textarea {
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  .btnrow {
    display: flex;
    gap: 5px;
    justify-content: flex-end;
    padding-top: 5px;
  }
  button {
    padding: 5px 10px;
    transition: background-color 0.2s ease-in-out;
    cursor: pointer;
  }
  button:hover {
    background-color: #aaa;
  }
  .editQuestion {
    display: none;
  }
</style>
<body>
  <h3 id="question">What did you like/dislike about the class?</h3>
  <label for="rating">My rating:</label>
  <select id="rating">
    <option value="1">Strongly Disagree</option>
    <option value="2">Disagree</option>
    <option value="3">Neutral</option>
    <option value="4">Agree</option>
    <option value="5">Strongly Agree</option>
  </select>
  <br><br>
  <label for="comment">Comment:</label>
  <textarea placeholder="Type a comment..." id="comment" rows="4"></textarea>
  <br>
  <div class="btnrow">
    <button id="closeButton">Close</button>
    <button id="submitButton">Submit</button>
  </div>

  <script>
    let currentUser = { photoUrl: "https://via.placeholder.com/20", name: "Anonymous" };

    window.onmessage = (event) => {
      if (event.data.pluginMessage.type === "init" && event.data.pluginMessage.user) {
        const { type, user, rating, question } = event.data.pluginMessage;
        currentUser = { photoUrl: user.photoUrl || "https://via.placeholder.com/20", name: user.name || "Anonymous" };
        document.getElementById("rating").value = rating;
        document.getElementById("question").innerText = question;
      }
    };

    document.getElementById("submitButton").onclick = () => {
      const rating = parseInt(document.getElementById("rating").value);
      const comment = document.getElementById("comment").value;
      const user = { icon: currentUser.photoUrl };

      parent.postMessage({ pluginMessage: { type: "submitResponse", user, rating, comment } }, "*");
      parent.postMessage({ pluginMessage: { type: "close" } }, "*");
    };

    document.getElementById("closeButton").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "close" } }, "*");
    };
  </script>
</body>
</html>
