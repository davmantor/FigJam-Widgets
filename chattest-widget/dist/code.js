(()=>{var W=Object.defineProperty,N=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var w=(e,n,i)=>n in e?W(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,F=(e,n)=>{for(var i in n||(n={}))j.call(n,i)&&w(e,i,n[i]);if(I)for(var i of I(n))O.call(n,i)&&w(e,i,n[i]);return e},y=(e,n)=>N(e,H(n));var{widget:R}=figma,{AutoLayout:d,Text:u,useSyncedState:m,Input:Y,Frame:q}=R;function G(){console.log("ChatWidget rendered");let[e,n]=m("newMessage",""),[i,p]=m("replyToId",null),[s,c]=m("messages",[]),[h,b]=m("userName","Anonymous"),[C,f]=m("inputPlaceholder","Type a message..."),[g,a]=m("inputActive",!1),[A,T]=m("isEditing",!1),K=()=>figma.widget.h(q,{width:"fill-parent",height:500,overflow:"scroll"},figma.widget.h(d,{direction:"vertical",spacing:-100,padding:4},M())),S=()=>{figma.currentUser&&figma.currentUser.name&&b(figma.currentUser.name)},E=()=>{if(console.log("handleAddMessage called1"),S(),e.trim()!==""){let o=Date.now(),t=new Date(o),r=t.getHours(),l=t.getMinutes(),U=l<10?"0"+l:l.toString(),B=r>=12?"PM":"AM",P=`${r%12||12}:${U} ${B}`,$=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:h;if(A){let x=s.map(D=>D.id===i?y(F({},D),{text:e.trim(),edited:!0}):D);c(x),p(null),T(!1)}else{let x={id:o,parentId:i,text:e.trim(),sender:$,timestamp:P,edited:!1,deleteConfirm:!1};c([...s,x]),p(null),T(!1)}n(""),f("Type a message..."),a(!0),setTimeout(()=>a(!1),2e3)}},L=o=>{p(o);let t=s.find(r=>r.id===o);t&&(n(""),f(`Reply to "${t.text}":`)),a(!0),setTimeout(()=>a(!1),2e3),T(!1)},k=o=>{if(s.find(r=>r.id===o)){let r=s.map(l=>l.id===o?y(F({},l),{text:"this message has been deleted",sender:"Anonymous",edited:!1}):l);c(r),p(null),n(""),f("Type a message..."),a(!0),setTimeout(()=>a(!1),2e3)}},v=o=>{let t=s.find(r=>r.id===o);t&&t.deleteConfirm===!1?c(r=>r.map(l=>l.id===o?y(F({},l),{deleteConfirm:!0}):l)):c(r=>r.map(l=>l.id===o?y(F({},l),{deleteConfirm:!1}):l))},z=o=>{let t=s.find(r=>r.id===o);t&&(p(o),n(t.text),f(`Edit message: "${t.text}"`),a(!0),T(!0),setTimeout(()=>a(!1),2e3))},M=(o=null)=>(console.log("render"),s.filter(t=>t.parentId===o).map(t=>figma.widget.h(J,{key:t.id,message:t,onReply:()=>L(t.id),onEdit:()=>z(t.id),onDelete:()=>k(t.id),onDeleteConfirm:()=>v(t.id),replyChain:M(t.id),replyToId:i,user:h})));return figma.widget.h(d,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(d,{direction:"horizontal",spacing:100,padding:8,stroke:g?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(Y,{placeholder:C,value:e,onTextEditEnd:o=>n(o.characters)}),figma.widget.h(d,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:E},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(d,{direction:"vertical",spacing:1,padding:4},M()))}function J({message:e,onReply:n,onDelete:i,onEdit:p,replyChain:s,replyToId:c,user:h,onDeleteConfirm:b}){console.log("MessageBubble called with message:",e,"and replyToId:",c);let C=e.parentId!==null,f=c===e.id;console.log(`Message ID: ${e.id}, ReplyTo ID: ${c}, Is Being Replied To: ${f}`);let g={fill:f?"#007AFF":"#FFFFFF",color:f?"#FFFFFF":"#000000"};console.log(g);let a=e.sender===h,A=e.edited;return console.log("edited",A),console.log("user",h),console.log("sender",e.sender),console.log(a),figma.widget.h(d,{direction:"vertical",padding:{top:10,bottom:10,left:C?32:8,right:8},stroke:"#D3D3D3",strokeWidth:1,cornerRadius:4,fill:g.fill},figma.widget.h(d,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:150,padding:{top:4,bottom:1,left:4,right:4}},figma.widget.h(u,{fontSize:14,fill:g.color},e.sender,":"),figma.widget.h(u,{fontSize:12,fill:g.color},e.timestamp)),figma.widget.h(d,{direction:"horizontal",padding:{top:4,bottom:4,left:4,right:4},fill:g.fill},figma.widget.h(u,null," ",e.text),A&&figma.widget.h(u,{fontSize:12,fill:"#808080"}," (edited)")),figma.widget.h(d,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},spacing:8},figma.widget.h(d,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:n},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Reply")),a&&!e.deleteConfirm&&figma.widget.h(d,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:b},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Delete")),a&&e.deleteConfirm&&figma.widget.h(d,{fill:"#FFFFFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:i},figma.widget.h(u,{fontSize:14,fill:"#FF3B30"},"Confirm Deletion")),a&&e.deleteConfirm&&figma.widget.h(d,{fill:"#FFFFFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:b},figma.widget.h(u,{fontSize:14,fill:"FF3B30"},"Cancel")),a&&figma.widget.h(d,{fill:"#808080",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:p},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Edit"))),s&&figma.widget.h(d,{direction:"vertical",spacing:10},s))}R.register(G);})();
