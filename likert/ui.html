<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Likert Scale Widget</title>
</head>
<body>
  <h3 id="question">What did you like/dislike about the class?</h3>
  <label for="rating">Select your rating:</label>
  <select id="rating">
    <option value="1">Strongly Disagree</option>
    <option value="2">Disagree</option>
    <option value="3">Neutral</option>
    <option value="4">Agree</option>
    <option value="5">Strongly Agree</option>
  </select>
  <br>
  <label for="comment">Your comment:</label>
  <textarea id="comment" rows="4"></textarea>
  <br>
  <button id="submitButton">Submit</button>
  <button id="closeButton">Close</button>

  <script>
    let currentUser = { photoUrl: "https://via.placeholder.com/20", name: "Anonymous" };

    window.onmessage = (event) => {
      const { type, user } = event.data.pluginMessage;
      console.log("here", user.photoUrl);
      if (type === "setUser" && user) {
        currentUser = { photoUrl: user.photoUrl || "https://via.placeholder.com/20", name: user.name || "Anonymous" };
      }
    };

    document.getElementById("submitButton").onclick = () => {
      const rating = parseInt(document.getElementById("rating").value);
      const comment = document.getElementById("comment").value;
      const user = { icon: currentUser.photoUrl };

      parent.postMessage({ pluginMessage: { type: "submitResponse", user, rating, comment } }, "*");
    };

    document.getElementById("closeButton").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "close" } }, "*");
    };
  </script>
</body>
</html>
