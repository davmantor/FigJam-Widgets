<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      :root { color-scheme: light dark; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-size: 13px; margin: 12px; }
      .hidden { display: none; }
      .row { margin-top: 10px; }
      .error { color: #c00; font-size: 12px; margin-top: 6px; min-height: 14px; }
      input[type="number"], input[type="text"] { width: 100%; box-sizing: border-box; }
      .btns { display: flex; gap: 8px; margin-top: 12px; }
      button { padding: 6px 10px; }
      label { display: block; margin-bottom: 4px; font-weight: 600; }
      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
  </head>
  <body>
    <!-- Password view -->
    <div id="pw" class="">
      <label>Password</label>
      <input id="pwd" type="text" />
      <div id="err" class="error"></div>
      <div class="btns">
        <button id="unlock">Unlock</button>
        <button id="cancel">Cancel</button>
      </div>
    </div>

    <!-- Admin panel view -->
    <div id="panel" class="hidden">
      <div class="grid">
        <div class="row">
          <label>Width (px)</label>
          <input id="width" type="number" min="280" max="1000" step="10" />
        </div>
        <div class="row">
          <label>Font size (base)</label>
          <input id="fontSize" type="number" min="10" max="24" step="1" />
        </div>
        <div class="row">
          <label>Border width (px)</label>
          <input id="borderWidth" type="number" min="0" max="8" step="1" />
        </div>
        <div class="row">
          <label>Border color</label>
          <input id="borderColor" type="text" placeholder="#000000" />
        </div>
      </div>

      <div class="btns">
        <button id="reset">Reset submission</button>
        <button id="done">Done</button>
      </div>
    </div>

    <script>
      // Tell widget we're ready
      parent.postMessage({ pluginMessage: { type: "ready" } }, "*");

      const pw = document.getElementById("pw");
      const panel = document.getElementById("panel");
      const err = document.getElementById("err");

      const widthEl = document.getElementById("width");
      const fontSizeEl = document.getElementById("fontSize");
      const borderWidthEl = document.getElementById("borderWidth");
      const borderColorEl = document.getElementById("borderColor");

      function showPassword() {
        pw.classList.remove("hidden");
        panel.classList.add("hidden");
        err.textContent = "";
        document.getElementById("pwd").focus();
      }
      function showPanel(values) {
        pw.classList.add("hidden");
        panel.classList.remove("hidden");
        if (values) {
          widthEl.value = values.boxWidth ?? 420;
          fontSizeEl.value = values.fontSizeBase ?? 14;
          borderWidthEl.value = values.borderWidth ?? 1;
          borderColorEl.value = values.borderColor ?? "#000000";
        }
      }

      onmessage = (event) => {
        const msg = event.data?.pluginMessage;
        if (!msg) return;
        if (msg.type === "promptPassword") showPassword();
        if (msg.type === "error") err.textContent = msg.message || "";
        if (msg.type === "showAdminPanel") showPanel(msg.values || {});
      };

      // actions
      document.getElementById("unlock").onclick = () => {
        const value = document.getElementById("pwd").value;
        parent.postMessage({ pluginMessage: { type: "passwordSubmit", value } }, "*");
      };
      document.getElementById("cancel").onclick = () => {
        parent.postMessage({ pluginMessage: { type: "close" } }, "*");
      };
      document.getElementById("done").onclick = () => {
        parent.postMessage({ pluginMessage: { type: "close" } }, "*");
      };
      document.getElementById("reset").onclick = () => {
        parent.postMessage({ pluginMessage: { type: "resetResponse" } }, "*");
      };

      // live updates
      widthEl.oninput = () => {
        const val = Number(widthEl.value);
        parent.postMessage({ pluginMessage: { type: "updateWidth", value: val } }, "*");
      };
      fontSizeEl.oninput = () => {
        const val = Number(fontSizeEl.value);
        parent.postMessage({ pluginMessage: { type: "updateFontSize", value: val } }, "*");
      };
      borderWidthEl.oninput = () => {
        const val = Number(borderWidthEl.value);
        parent.postMessage({ pluginMessage: { type: "updateBorderWidth", value: val } }, "*");
      };
      borderColorEl.oninput = () => {
        const val = borderColorEl.value.trim();
        parent.postMessage({ pluginMessage: { type: "updateBorderColor", value: val } }, "*");
      };
    </script>
  </body>
</html>
