"use strict";(()=>{var{widget:F}=figma,{AutoLayout:t,Text:l,useSyncedState:s,Input:x,Frame:v}=F;function L(){console.log("ChatWidget rendered");let[o,d]=s("newMessage",""),[g,c]=s("replyToId",null),[i,p]=s("messages",[]),[u,r]=s("userName","Anonymous"),[b,y]=s("inputPlaceholder","Type a message..."),[A,f]=s("inputActive",!1),C=()=>figma.widget.h(v,{width:"fill-parent",height:500,overflow:"scroll"},figma.widget.h(t,{direction:"vertical",spacing:-100,padding:4},m())),z=()=>{figma.currentUser&&figma.currentUser.name&&r(figma.currentUser.name)},M=()=>{if(console.log("handleAddMessage called1"),o.trim()!==""){let n=Date.now(),e=new Date(n),a=e.getHours(),h=e.getMinutes(),w=h<10?"0"+h:h.toString(),I=a>=12?"PM":"AM",R=`${a%12||12}:${w} ${I}`,D=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:u,S={id:n,parentId:g,text:o.trim(),sender:D,timestamp:R};p([...i,S]),d(""),c(null),y("Type a message..."),f(!0),setTimeout(()=>f(!1),2e3)}},T=n=>{c(n);let e=i.find(a=>a.id===n);e&&(d(""),y(`Reply to "${e.text}":`)),f(!0),setTimeout(()=>f(!1),2e3)},m=(n=null)=>(console.log("render"),i.filter(e=>e.parentId===n).map(e=>figma.widget.h(k,{key:e.id,message:e,onReply:()=>T(e.id),onDelete:()=>p(i.filter(a=>a.id!==e.id)),replyChain:m(e.id),replyToId:g})));return figma.widget.h(t,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(t,{direction:"horizontal",spacing:100,padding:8,stroke:A?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(x,{placeholder:b,value:o,onTextEditEnd:n=>d(n.characters)}),figma.widget.h(t,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:M},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(t,{direction:"vertical",spacing:-100,padding:4},m()))}function k({message:o,onReply:d,onDelete:g,replyChain:c,replyToId:i}){console.log("MessageBubble called with message:",o,"and replyToId:",i);let p=o.parentId!==null,u=i===o.id;console.log(`Message ID: ${o.id}, ReplyTo ID: ${i}, Is Being Replied To: ${u}`);let r={fill:u?"#007AFF":"#FFFFFF",color:u?"#FFFFFF":"#000000"};return console.log(r),figma.widget.h(t,{direction:"vertical",padding:{top:1,bottom:10,left:p?32:8,right:8},stroke:"#D3D3D3",strokeWidth:1,cornerRadius:4,fill:r.fill},figma.widget.h(t,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:150,padding:{top:4,bottom:0,left:4,right:4}},figma.widget.h(l,{fontSize:14,fill:r.color},o.sender,":"),figma.widget.h(l,{fontSize:12,fill:r.color},o.timestamp)),figma.widget.h(t,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},fill:r.fill},figma.widget.h(l,null," ",o.text)),figma.widget.h(t,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},spacing:8},figma.widget.h(t,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:d},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Reply")),figma.widget.h(t,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:g},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Delete"))),c&&figma.widget.h(t,{direction:"vertical",spacing:30},c))}F.register(L);})();
