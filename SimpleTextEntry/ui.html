<!-- ui.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      :root { color-scheme: light dark; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-size: 13px; margin: 12px; }
      .hidden { display: none; }
      .row { margin-top: 10px; }
      .error { color: #c00; font-size: 12px; margin-top: 6px; min-height: 14px; }
      input[type="number"], input[type="text"] { width: 100%; box-sizing: border-box; }
      .btns { display: flex; gap: 8px; margin-top: 12px; }
      button { padding: 6px 10px; }
      label { display: block; margin-bottom: 4px; font-weight: 600; }
      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
    </style>
  </head>
  <body>
    <!-- Password view -->
    <div id="pw" class="">
      <label>Password</label>
      <input id="pwd" type="password" autocomplete="current-password" enterkeyhint="go"/>
      <div id="err" class="error"></div>
      <div class="btns">
        <button id="unlock">Unlock</button>
        <button id="cancel">Cancel</button>
      </div>
    </div>

    <!-- Admin panel view -->
    <div id="panel" class="hidden">
      <div class="grid">
        <div class="row">
          <label>Width (px)</label>
          <input id="width" type="number" min="280" max="1200" step="10" />
        </div>
        <div class="row">
          <label>Height (px)</label>
          <input id="height" type="number" min="160" max="1200" step="10" />
        </div>
        <div class="row">
          <label>Font size (base)</label>
          <input id="fontSize" type="number" min="10" max="24" step="1" />
        </div>
        <div class="row">
          <label>Border width (px)</label>
          <input id="borderWidth" type="number" min="0" max="8" step="1" />
        </div>
        <div class="row">
          <label>Border color</label>
          <input id="borderColor" type="text" placeholder="#000000" />
        </div>
      </div>

      <h4 style="margin-top:16px;">Shadow</h4>
      <div class="grid">
        <div class="row">
          <label>Color</label>
          <input id="shadowColor" type="text" placeholder="#0000001A" />
        </div>
        <div class="row">
          <label>Blur</label>
          <input id="shadowBlur" type="number" min="0" max="64" step="1" />
        </div>
        <div class="row">
          <label>Spread</label>
          <input id="shadowSpread" type="number" min="0" max="32" step="1" />
        </div>
      </div>
      <div class="grid">
        <div class="row">
          <label>Offset X</label>
          <input id="shadowOffsetX" type="number" min="-32" max="32" step="1" />
        </div>
        <div class="row">
          <label>Offset Y</label>
          <input id="shadowOffsetY" type="number" min="-32" max="32" step="1" />
        </div>
      </div>

      <div class="btns">
        <button id="unlockEdit">Edit submission</button>
        <button id="reset">Reset submission</button>
        <button id="done">Done</button>
      </div>
    </div>

    <script>
      parent.postMessage({ pluginMessage: { type: "ready" } }, "*");

      const pw = document.getElementById("pw");
      const panel = document.getElementById("panel");
      const err = document.getElementById("err");

      const widthEl = document.getElementById("width");
      const heightEl = document.getElementById("height");
      const fontSizeEl = document.getElementById("fontSize");
      const borderWidthEl = document.getElementById("borderWidth");
      const borderColorEl = document.getElementById("borderColor");

      const shadowColorEl = document.getElementById("shadowColor");
      const shadowOffsetXEl = document.getElementById("shadowOffsetX");
      const shadowOffsetYEl = document.getElementById("shadowOffsetY");
      const shadowBlurEl = document.getElementById("shadowBlur");
      const shadowSpreadEl = document.getElementById("shadowSpread");

      const pwdEl = document.getElementById("pwd");
      const unlockBtn = document.getElementById("unlock");

      pwdEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          unlockBtn.click();
        }
      });

      pwdEl.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          document.getElementById("cancel").click();
        }
      });

      function showPassword() {
        pw.classList.remove("hidden");
        panel.classList.add("hidden");
        err.textContent = "";
        document.getElementById("pwd").focus();
      }
      function showPanel(values) {
        pw.classList.add("hidden");
        panel.classList.remove("hidden");
        if (values) {
          widthEl.value = values.boxWidth ?? 1020;
          heightEl.value = values.boxHeight ?? 235;                 // NEW
          fontSizeEl.value = values.fontSizeBase ?? 16;
          borderWidthEl.value = values.borderWidth ?? 1;
          borderColorEl.value = values.borderColor ?? "#000000";

          // NEW: shadow fields
          shadowColorEl.value = values.shadowColor ?? "#000000";
          shadowOffsetXEl.value = values.shadowOffsetX ?? 0;
          shadowOffsetYEl.value = values.shadowOffsetY ?? 2;
          shadowBlurEl.value = values.shadowBlur ?? 10;
          shadowSpreadEl.value = values.shadowSpread ?? 0;
        }
      }

      onmessage = (event) => {
        const msg = event.data?.pluginMessage;
        if (!msg) return;
        if (msg.type === "promptPassword") showPassword();
        if (msg.type === "error") err.textContent = msg.message || "";
        if (msg.type === "showAdminPanel") showPanel(msg.values || {});
      };

      document.getElementById("unlock").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "passwordSubmit", value: document.getElementById("pwd").value } }, "*");
      document.getElementById("cancel").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "close" } }, "*");
      document.getElementById("done").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "close" } }, "*");
      document.getElementById("reset").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "resetResponse" } }, "*");

      // Live updates
      widthEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateWidth", value: Number(widthEl.value) } }, "*");
      heightEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateHeight", value: Number(heightEl.value) } }, "*");
      fontSizeEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateFontSize", value: Number(fontSizeEl.value) } }, "*");
      borderWidthEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateBorderWidth", value: Number(borderWidthEl.value) } }, "*");
      borderColorEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateBorderColor", value: borderColorEl.value.trim() } }, "*");

      // Shadow live updates â€” NEW
      shadowColorEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowColor", value: shadowColorEl.value.trim() } }, "*");
      shadowOffsetXEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowOffsetX", value: Number(shadowOffsetXEl.value) } }, "*");
      shadowOffsetYEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowOffsetY", value: Number(shadowOffsetYEl.value) } }, "*");
      shadowBlurEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowBlur", value: Number(shadowBlurEl.value) } }, "*");
      shadowSpreadEl.oninput = () =>
        parent.postMessage({ pluginMessage: { type: "updateShadowSpread", value: Number(shadowSpreadEl.value) } }, "*");

      document.getElementById("unlockEdit").onclick = () =>
        parent.postMessage({ pluginMessage: { type: "unlockForEdit" } }, "*");
    </script>
  </body>
</html>
