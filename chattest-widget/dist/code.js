"use strict";(()=>{var{widget:F}=figma,{AutoLayout:n,Text:s,useSyncedState:r,Input:v,Frame:L}=F;function k(){console.log("ChatWidget rendered2");let[t,a]=r("newMessage",""),[c,l]=r("replyToId",null),[i,p]=r("messages",[]),[d,u]=r("userName","Anonymous"),[b,y]=r("inputPlaceholder","Type a message..."),[A,g]=r("inputActive",!1);console.log("Current messages:",i);let z=()=>figma.widget.h(L,{width:"fill-parent",height:500,overflow:"scroll"},figma.widget.h(n,{direction:"vertical",spacing:-100,padding:4},m())),U=()=>{figma.currentUser&&figma.currentUser.name&&u(figma.currentUser.name)};function M(o){p(i.map(e=>e.id===o?{id:e.id,parentId:e.parentId,text:"*This message was deleted*",sender:void 0,timestamp:void 0,isDeleted:!0}:e))}let T=()=>{if(console.log("handleAddMessage called"),t.trim()!==""){let o=Date.now(),e=new Date(o),f=e.getHours(),h=e.getMinutes(),D=h<10?"0"+h:h.toString(),I=f>=12?"PM":"AM",R=`${f%12||12}:${D} ${I}`,x=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:d,S={id:o,parentId:c,text:t.trim(),sender:x,timestamp:R};p([...i,S]),a(""),l(null),y("Type a message..."),g(!0),setTimeout(()=>g(!1),2e3)}},w=o=>{l(o);let e=i.find(f=>f.id===o);e&&(a(""),y(`Reply to "${e.text}":`)),g(!0),setTimeout(()=>g(!1),2e3)},m=(o=null)=>i.filter(e=>e.parentId===o).map(e=>figma.widget.h(C,{key:e.id,message:e,onReply:()=>w(e.id),onDelete:()=>M(e.id),replyChain:m(e.id),replyToId:c}));return figma.widget.h(n,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(n,{direction:"horizontal",spacing:100,padding:8,stroke:A?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(v,{placeholder:b,value:t,onTextEditEnd:o=>a(o.characters)}),figma.widget.h(n,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:T},figma.widget.h(s,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(n,{direction:"vertical",spacing:-100,padding:4},m()))}function C({message:t,onReply:a,onDelete:c,replyChain:l,replyToId:i}){console.log("MessageBubble called with message:",t,"and replyToId:",i);let p=t.parentId!==null,d=i===t.id;console.log(`Message ID: ${t.id}, ReplyTo ID: ${i}, Is Being Replied To: ${d}`);let u={fill:d?"#007AFF":"#FFFFFF",color:d?"#FFFFFF":"#000000"};return console.log(u),figma.widget.h(n,{direction:"vertical",padding:{top:1,bottom:10,left:p?32:8,right:8},stroke:"#D3D3D3",strokeWidth:1,cornerRadius:4,fill:u.fill},!t.isDeleted&&figma.widget.h(n,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:150,padding:{top:4,bottom:0,left:4,right:4}},t.sender&&figma.widget.h(s,{fontSize:14},t.sender,":"),t.timestamp&&figma.widget.h(s,{fontSize:12},t.timestamp)),figma.widget.h(n,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},fill:u.fill},figma.widget.h(s,null,t.isDeleted?t.text="*This message was deleted*":t.text)),!t.isDeleted&&figma.widget.h(n,{direction:"horizontal",padding:{top:4,bottom:0,left:4,right:4},spacing:8},figma.widget.h(n,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:a},figma.widget.h(s,{fontSize:14,fill:"#FFFFFF"},"Reply")),figma.widget.h(n,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:c},figma.widget.h(s,{fontSize:14,fill:"#FFFFFF"},"Delete"))),l&&figma.widget.h(n,{direction:"vertical",spacing:30},l))}F.register(k);})();
