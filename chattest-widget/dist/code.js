(()=>{var{widget:h}=figma,{AutoLayout:o,Text:u,useSyncedState:a,Input:k,Frame:U}=h;function v(){console.log("ChatWidget rendered");let[t,l]=a("newMessage",""),[p,d]=a("replyToId",null),[i,g]=a("messages",[]),[c,s]=a("userName","Anonymous"),[b,F]=a("inputPlaceholder","Type a message..."),[A,m]=a("inputActive",!1),L=()=>{figma.currentUser&&figma.currentUser.name&&s(figma.currentUser.name)},M=()=>{if(console.log("handleAddMessage called1"),t.trim()!==""){let n=Date.now(),e=new Date(n),r=e.getHours(),f=e.getMinutes(),I=f<10?"0"+f:f.toString(),R=r>=12?"PM":"AM",w=`${r%12||12}:${I} ${R}`,D=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:c,S={id:n,parentId:p,text:t.trim(),sender:D,timestamp:w};g([...i,S]),l(""),d(null),F("Type a message..."),m(!0),setTimeout(()=>m(!1),2e3)}},T=n=>{d(n);let e=i.find(r=>r.id===n);e&&(l(""),F(`Reply to "${e.text}":`)),m(!0),setTimeout(()=>m(!1),2e3)},y=(n=null)=>(console.log("render"),i.filter(e=>e.parentId===n).map(e=>figma.widget.h(x,{key:e.id,message:e,onReply:()=>T(e.id),onDelete:()=>g(i.filter(r=>r.id!==e.id)),replyChain:y(e.id),replyToId:p})));return figma.widget.h(o,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(o,{direction:"horizontal",spacing:100,padding:8,stroke:A?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(k,{placeholder:b,value:t,onTextEditEnd:n=>l(n.characters)}),figma.widget.h(o,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:M},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(o,{direction:"vertical",spacing:-100,padding:4},y()))}function x({message:t,onReply:l,onDelete:p,replyChain:d,replyToId:i}){console.log("MessageBubble called with message:",t,"and replyToId:",i);let g=t.parentId!==null,c=i===t.id;console.log(`Message ID: ${t.id}, ReplyTo ID: ${i}, Is Being Replied To: ${c}`);let s={fill:c?"#007AFF":"#FFFFFF",color:c?"#FFFFFF":"#000000"};return console.log(s),figma.widget.h(o,{direction:"vertical",padding:{top:1,bottom:1,left:g?32:8,right:8}},figma.widget.h(o,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:4,padding:{top:4,bottom:4,left:4,right:4},stroke:"#DADCE0",strokeWidth:1,cornerRadius:4,fill:s.fill},figma.widget.h(u,{fontSize:14,width:"fill-parent",fill:s.color},t.sender,": ",t.text),figma.widget.h(u,{fontSize:12,fill:s.color},t.timestamp),figma.widget.h(o,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:l},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Reply")),figma.widget.h(o,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:p},figma.widget.h(u,{fontSize:14,fill:"#FFFFFF"},"Delete"))),d&&figma.widget.h(o,{direction:"vertical",spacing:-100},d))}h.register(v);})();
