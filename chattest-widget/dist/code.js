(()=>{var{widget:y}=figma,{AutoLayout:n,Text:l,useSyncedState:a,Input:x,Frame:C}=y;function D(){let[o,r]=a("newMessage",""),[c,d]=a("replyToId",null),[i,p]=a("messages",[]),[g,h]=a("userName","Anonymous"),[F,m]=a("inputPlaceholder","Type a message..."),[b,u]=a("inputActive",!1),L=()=>{figma.currentUser&&figma.currentUser.name&&h(figma.currentUser.name)},A=()=>{if(console.log("handleAddMessage called"),o.trim()!==""){let t=Date.now(),e=new Date(t),s=e.getHours(),R=e.getMinutes().toString().padStart(2,"0"),I=s>=12?"PM":"AM",T=`${s%12||12}:${R} ${I}`,S=figma.currentUser&&figma.currentUser.name?figma.currentUser.name:g,w={id:t,parentId:c,text:o.trim(),sender:S,timestamp:T};p([...i,w]),r(""),d(null),m("Type a message..."),u(!0),setTimeout(()=>u(!1),2e3)}},M=t=>{d(t);let e=i.find(s=>s.id===t);e&&(r(""),m(`Reply to "${e.text}":`)),u(!0),setTimeout(()=>u(!1),2e3)},f=(t=null)=>i.filter(e=>e.parentId===t).map(e=>figma.widget.h(v,{key:e.id,message:e,onReply:()=>M(e.id),onDelete:()=>p(i.filter(s=>s.id!==e.id)),replyChain:f(e.id)}));return figma.widget.h(n,{direction:"vertical",spacing:8,padding:8,stroke:"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(n,{direction:"horizontal",spacing:4,padding:8,stroke:b?"#007AFF":"#DADCE0",strokeWidth:1,cornerRadius:4},figma.widget.h(x,{placeholder:F,value:o,onTextEditEnd:t=>r(t.characters)}),figma.widget.h(n,{fill:"#007AFF",padding:8,cornerRadius:4,onClick:A},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Send"))),figma.widget.h(n,{direction:"vertical",spacing:2,padding:4},f()))}function v({message:o,onReply:r,onDelete:c,replyChain:d}){let i=o.parentId!==null,p={marginLeft:i?"16px":"0"},g={marginBottom:i?"1px":"0px"};return figma.widget.h(n,{direction:"vertical",padding:{top:4,bottom:4,left:i?32:8,right:8}},figma.widget.h(n,{direction:"horizontal",horizontalAlignItems:"start",verticalAlignItems:"center",spacing:4,padding:{top:4,bottom:4,left:4,right:4},stroke:"#DADCE0",strokeWidth:1,cornerRadius:4,fill:"#FFFFFF"},figma.widget.h(l,{fontSize:14,width:"fill-parent"},o.sender,": ",o.text),figma.widget.h(l,{fontSize:12,fill:"#777777"},o.timestamp),figma.widget.h(n,{fill:"#007AFF",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:r},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Reply")),figma.widget.h(n,{fill:"#FF3B30",cornerRadius:4,padding:{top:6,bottom:6,left:8,right:8},onClick:c},figma.widget.h(l,{fontSize:14,fill:"#FFFFFF"},"Delete"))),d&&figma.widget.h(n,{direction:"vertical",spacing:-100},d))}y.register(D);})();
